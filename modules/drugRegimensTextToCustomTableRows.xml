<freemarkerTextToGlueTransformer>
	<freemarkerTemplate><![CDATA[
<#list rows as row>
  <#assign id>${row["id"]?trim}</#assign>
  <#assign displayName>${row["display_name"]?trim}</#assign>
  <#assign shortDisplayName>${row["short_display_name"]?trim}</#assign>
  <#assign drugs>${row["drugs"]?trim}</#assign>
  <#assign availableAlmts>${row["available_almts"]?trim}</#assign>
  <#assign suboptimalAlmts>${row["suboptimal_almts"]?trim}</#assign>
  create custom-table-row drug_regimen "${id}"
  custom-table-row drug_regimen "${id}"
    set field display_name "${displayName}"
    set field short_display_name "${shortDisplayName}"
    exit
    
  <#if availableAlmts != "">
	<#list availableAlmts?split(",") as availableAlmt>
  create custom-table-row drug_regimen_alignment "${id}_${availableAlmt}"
  custom-table-row drug_regimen_alignment "${id}_${availableAlmt}"
    set link-target drug_regimen "custom-table-row/drug_regimen/${id}"
    set link-target alignment "alignment/${availableAlmt}"
    set field recommendation_level available
    exit
	</#list>
  </#if>

  <#if suboptimalAlmts != "">
	<#list suboptimalAlmts?split(",") as suboptimalAlmt>
  create custom-table-row drug_regimen_alignment "${id}_${suboptimalAlmt}"
  custom-table-row drug_regimen_alignment "${id}_${suboptimalAlmt}"
    set link-target drug_regimen "custom-table-row/drug_regimen/${id}"
    set link-target alignment "alignment/${suboptimalAlmt}"
    set field recommendation_level suboptimal
    exit
	</#list>
  </#if>
  
  <#list drugs?split(",") as drug>
  create custom-table-row drug_regimen_drug "${id}_${drug}"
  custom-table-row drug_regimen_drug "${id}_${drug}"
    set link-target drug_regimen "custom-table-row/drug_regimen/${id}"
    set link-target drug "custom-table-row/drug/${drug}"
    exit
  </#list>
    
</#list>
]]></freemarkerTemplate>
</freemarkerTextToGlueTransformer>